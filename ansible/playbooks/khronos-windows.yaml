---
- name: Setup Khoronos (Windows)
  hosts: khronos
  vars_prompt:
    - name: win_username
      prompt: 'Windows username'
      private: false
    - name: win_password
      prompt: 'Windows password'
      private: true
  vars:
    # ansible
    ansible_user: '{{ win_username }}'
    ansible_password: '{{ win_password }}'
    ansible_become_method: runas
    ansible_become_user: '{{ win_username }}'
    ansible_become_password: '{{ win_password }}'
    ansible_connection: ssh
    ansible_shell_type: powershell
    ansible_python_interpreter: /home/linuxbrew/.linuxbrew/bin/python3
    # common
    my_home: 'C:\Users\{{ user }}'
    my_user: '{{ win_username }}'
    my_editor: code
    my_visual: code
    # my_temporary_home: D:\Temp\{{ user }}
    my_xdg_cache_home: 'C:\Users\{{ user }}\AppData\Roaming'
    my_xdg_config_home: 'C:\Users\{{ user }}\AppData\Local'
    my_xdg_data_home: 'C:\Users\{{ user }}\AppData\Local'
    my_google_drive: 'G:\マイドライブ'
  pre_tasks:
    - name: Run always
      tags: always
      block:
        - name: Include common vars
          ansible.builtin.include_vars: common.yaml
  tasks:
    - name: Import os_windows
      ansible.builtin.import_role:
        name: os_windows
    - name: Import winget
      ansible.builtin.import_role:
        name: winget
      vars:
        winget_packages:
          - { name: AgileBits.1Password }
          - { name: Anthropic.Claude }
          # - { name: Apple.Bonjour } # インストールに失敗する
          - { name: Apple.iTunes }
          - { name: ArduinoSA.IDE.stable }
          - { name: Audacity.Audacity }
          - { name: AutoHotkey.AutoHotkey }
          - { name: Bandisoft.Honeyview }
          - { name: calibre.calibre }
          - { name: Cloudflare.cloudflared }
          - { name: CPUID.CPU-Z.MSI }
          - { name: CPUID.HWMonitor }
          - { name: DEVCOM.JMeter }
          - { name: Discord.Discord }
          - { name: Doist.Todoist }
          - { name: dorssel.usbipd-win }
          - { name: ElaborateBytes.VirtualCloneDrive }
          - { name: Fork.Fork }
          - { name: GIMP.GIMP.3 }
          - { name: GnuPG.Gpg4win }
          - { name: Google.Chrome }
          - { name: Google.Chrome.Dev }
          - { name: Google.GoogleDrive }
          - { name: GuinpinSoft.MakeMKV }
          - { name: Inkscape.Inkscape }
          # - { name: Google.JapaneseIME, become: false, force: true } # ハッシュが一致しない
          - { name: Kensington.KensingtonWorks }
          - { name: LIGHTNINGUK.ImgBurn }
          - { name: LINQPad.LINQPad.8 }
          - { name: M2Team.NanaZip }
          - { name: Meltytech.Shotcut }
          - { name: Microsoft.PowerShell }
          - { name: Microsoft.PowerToys }
          - { name: Microsoft.SQLServerManagementStudio }
          - { name: Microsoft.VisualStudio.2022.Community }
          - { name: Microsoft.WindowsTerminal }
          - { name: Mozilla.Firefox.ja }
          - { name: NickeManarin.ScreenToGif }
          - { name: Notion.Notion }
          - { name: OBSProject.OBSStudio }
          - { name: Ollama.Ollama }
          - { name: PeterBienstman.Mnemosyne, list_id: Mnemosyne_is1 }
          - { name: Rufus.Rufus }
          - { name: RustemMussabekov.Raindrop }
          - { name: SlackTechnologies.Slack }
          - { name: Spotify.Spotify }
          - { name: TeraTermProject.teraterm }
          - { name: Unity.UnityHub }
          - { name: Valve.Steam }
          - { name: Vivaldi.Vivaldi }
          - { name: VideoLAN.VLC }
          - { name: WinMerge.WinMerge }
          - { name: WinSCP.WinSCP }
          - { name: XPFFTQ032PTPHF } # UniGetUI
          - { name: Yamaha.SteinbergUSBDriver }
    - name: Import scoop
      ansible.builtin.import_role:
        name: scoop
      vars:
        scoop_buckets:
          - main
          - extras
        scoop_packages:
          - { name: 1password-cli }
          - { name: 7zip }
          - { name: busybox }
          - { name: dark }
          - { name: dust }
          - { name: fastfetch }
          - { name: ffmpeg }
          - { name: fzf }
          - { name: gh }
          - { name: ghq }
          - { name: git }
          - { name: go }
          - { name: gradle }
          - { name: graphviz }
          - { name: hadolint }
          - { name: helm }
          - { name: innounp }
          - { name: neovim }
          - { name: nodejs-lts }
          - { name: pandoc }
          - { name: pasteboard }
          - { name: perl }
          - { name: plantuml }
          - { name: python }
          - { name: scoop-search }
          - { name: shellcheck }
          - { name: vscode }
          - { name: youtube-dl }
          - { name: zed }
    - name: Import home
      ansible.builtin.import_role:
        name: home
        tasks_from: windows
      vars:
        home_standard_directories:
          - Applications
          - Archives
          - Projects
        home_my_git_config: '{{ dotfiles }}/git/.gitconfig-prv'
        home_my_git_config_local: '{{ dotfiles }}/git/.gitconfig-prv.win.local'
        home_my_git_ignore: '{{ dotfiles }}/git/ignore'
    - name: Import claude
      ansible.builtin.import_role:
        name: claude
        tasks_from: windows
      vars:
        claude_settings: '{{ dotfiles }}/claude/settings.json'
        claude_md: '{{ dotfiles }}/claude/CLAUDE.md'
        claude_commands: '{{ dotfiles }}/claude/commands'
        claude_agents: '{{ dotfiles }}/claude/agents'
        claude_skills: '{{ dotfiles }}/claude/skills'

- name: Setup Khronos (WSL)
  hosts: local
  vars_prompt:
    - name: my_password
      prompt: 'WSL user password'
      private: true
  vars:
    # ansible
    ansible_python_interpreter: /home/linuxbrew/.linuxbrew/bin/python3
    # common
    my_editor: nvim
    my_visual: nvim
    my_temporary_home: /tmp
  pre_tasks:
    - name: Run always
      tags: always
      block:
        - name: Include common vars
          ansible.builtin.include_vars: common.yaml
  handlers:
    - name: Include handlers
      ansible.builtin.import_tasks: handlers/handlers_wsl.yaml
  tasks:
    - name: Import wsl
      ansible.builtin.import_role:
        name: wsl
    - name: Import apt
      ansible.builtin.import_role:
        name: apt
      vars:
        apt_keys:
          - url: 'https://dl-ssl.google.com/linux/linux_signing_key.pub'
            filename: 'google-chrome.gpg'
        apt_repositories:
          - repo: 'deb [arch=amd64 signed-by=/usr/share/keyrings/google-chrome.gpg] http://dl.google.com/linux/chrome/deb/ stable main'
            filename: 'google-chrome'
        apt_packages:
          - google-chrome-stable
          - autoconf # for asdf-erlang
          - build-essential # for ansible, asdf-erlang
          - fop # for asdf-erlang
          - libgl1-mesa-dev # for asdf-erlang
          - libglu1-mesa-dev # for asdf-erlang
          - libncurses-dev # for asdf-erlang
          - libncurses5-dev # for asdf-erlang
          - libpng-dev # for asdf-erlang
          - libssl-dev # for asdf-erlang
          - libwxgtk3.0-gtk3-dev # for asdf-erlang
          - libwxgtk-webview3.0-gtk3-dev # for asdf-erlang
          - openjdk-11-jdk # for asdf-erlang
          - m4 # for asdf-erlang
          - unixodbc-dev # for asdf-erlang
          - xsltproc # for asdf-erlang
    - name: Import homebrew
      ansible.builtin.import_role:
        name: homebrew
      vars:
        homebrew_brewfile: '{{ playbook_dir }}/files/homebrew/Brewfile-wsl'
    - name: Import home
      ansible.builtin.import_role:
        name: home
        tasks_from: windows.wsl
      vars:
        home_host_home: '{{ "/mnt/c/Users/" + (home | basename) }}'
        home_standard_directories:
          - Projects
        home_my_git_config: '{{ dotfiles }}/git/.gitconfig-prv'
        home_my_git_config_local: '{{ dotfiles }}/git/.gitconfig-prv.wsl.local'
        home_my_git_ignore: '{{ dotfiles }}/git/ignore'
        home_my_ghostty_config: '{{ dotfiles }}/ghostty/config'
    - name: Import fish
      ansible.builtin.import_role:
        name: fish
      vars:
        fish_shell_config: config-wsl.fish
    - name: Import mise
      ansible.builtin.import_role:
        name: mise
      vars:
        mise_config: '{{ dotfiles }}/mise/config-wsl.toml'
        mise_default_go_packages: '{{ dotfiles }}/mise/.default-go-packages'
        mise_default_python_packages: '{{ dotfiles }}/mise/.default-python-packages'
        mise_default_npm_packages: '{{ dotfiles }}/mise/.default-npm-packages'
        mise_default_gems: '{{ dotfiles }}/mise/.default-gems'
        mise_default_mix_commands: '{{ dotfiles }}/mise/.default-mix-commands'
        mise_default_perl_modules: '{{ dotfiles }}/mise/.default-perl-modules'
    - name: Import nvim
      ansible.builtin.import_role:
        name: nvim
    - name: Import claude
      ansible.builtin.import_role:
        name: claude
      vars:
        claude_settings: '{{ dotfiles }}/claude/settings.json'
        claude_md: '{{ dotfiles }}/claude/CLAUDE.md'
        claude_commands: '{{ dotfiles }}/claude/commands'
        claude_agents: '{{ dotfiles }}/claude/agents'
        claude_skills: '{{ dotfiles }}/claude/skills'
