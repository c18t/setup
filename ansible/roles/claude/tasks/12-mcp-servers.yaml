---
- name: 12-mcp-servers | Check installed MCP servers
  ansible.builtin.shell: claude mcp list
  args:
    executable: '{{ claude_fish_path }}'
  register: claude_mcp_list
  changed_when: false
  failed_when: false

- name: 12-mcp-servers | Add context7 MCP server
  ansible.builtin.shell: >
    claude mcp add --scope user context7 --
    npx -y @upstash/context7-mcp
  args:
    executable: '{{ claude_fish_path }}'
  when: "'context7' not in claude_mcp_list.stdout"
  register: claude_mcp_add_context7
  changed_when: claude_mcp_add_context7.rc == 0

- name: 12-mcp-servers | Add ccusage MCP server
  ansible.builtin.shell: >
    claude mcp add --scope user ccusage --
    npx -y @ccusage/mcp
  args:
    executable: '{{ claude_fish_path }}'
  when: "'ccusage' not in claude_mcp_list.stdout"
  register: claude_mcp_add_ccusage
  changed_when: claude_mcp_add_ccusage.rc == 0

- name: 12-mcp-servers | Add playwright MCP server
  ansible.builtin.shell: >
    claude mcp add --scope user playwright --
    npx -y @playwright/mcp
  args:
    executable: '{{ claude_fish_path }}'
  when: "'playwright' not in claude_mcp_list.stdout"
  register: claude_mcp_add_playwright
  changed_when: claude_mcp_add_playwright.rc == 0
